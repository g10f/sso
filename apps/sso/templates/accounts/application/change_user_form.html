{% extends "base_form.html" %}
{% load i18n admin_static %}
{% load thumbnail %}

{% block nav_accounts_user_list_class %}active{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
    <li><a href="{% url 'home' %}">{% trans 'Home' %}</a></span></li>
    <li><a href="{% url 'accounts:user_list' %}">{% trans 'User List' %}</a></li>
    <li class="active">{% trans 'Change User' %}</li>
</ul> 
{% endblock breadcrumb %}

{% block form %}
<form class="form-horizontal" method="post">{% csrf_token %} 
    {# Include the hidden fields in the form #}
    {% for hidden in form.hidden_fields %}
    {{ hidden }}
    {% endfor %}    
    
    <div class="">
	    <legend>{{ title }} - {{ form.user }}</legend>
	    {% block messages %}
	      {% if messages %}
	      {% for message in messages %}
	      <div class="alert alert-{% if message.tags %}{{ message.tags }}{% endif %}">
	        {{ message }}
	      </div>
	      {% endfor %}
	      {% endif %}
	    {% endblock messages %}
	    
	    {% if form.errors %}
	        <div class="alert alert-danger">
	        {% blocktrans count counter=form.errors.items|length %}Please correct the error below.{% plural %}Please correct the errors below.{% endblocktrans %}
	        </div>
	    {% endif %}
    </div>

     <ul class="nav nav-tabs" id="myTab">
       <li class="active"><a data-toggle="tab" href="#user">{% trans 'User data' %}</a></li>
       <li><a data-toggle="tab" href="#app_roles">{{ form.application_roles.label }}</a></li>
     </ul>
    
     <div class="tab-content">
       <div class="tab-pane active" id="user"> 
        <div>      
         <div class="row form-group">
           <label class="col-sm-3 control-label">{% trans 'picture' %}</label>    
           <div class="col-sm-9 dw-form-control">
            {% thumbnail form.user.picture "108x108" as im %}<img src="{{ im.url }}" width="{{ im.width }}" height="{{ im.height }}">{% endthumbnail %}          
           </div>
         </div>
       
         {% include 'include/_field.html' with field=form.first_name %}
         {% include 'include/_field.html' with field=form.last_name %}
         {% include 'include/_field.html' with field=form.organisations %}
         {% include 'include/_field.html' with field=form.is_active %}            
         {% include 'include/_email_field.html' with field=form.email %} 

         {% if perms.registration.change_registrationprofile %}
         {% with registrationprofile=form.user.registrationprofile %}
         {% if registrationprofile %}        
         <div class="row form-group">
           <label class="col-sm-3 control-label"></label>    
           <div class="col-sm-9 dw-form-control">
              <a href="{% url 'registration:update_user_registration' registrationprofile.pk %}" >{% trans 'Registration' %}</a>
           </div>
         </div>
         {% endif %}
         {% endwith %}
         {% endif %}
         
       </div>
      </div>
       
      <div class="tab-pane" id="app_roles">
        <div>
         {% with field=form.application_roles %}
         <div class="row form-group {% if field.errors %}has-error{% endif %}">
           <div class="col-sm-12">
             {{ field }}{% if field.help_text or field.errors %}<span class="help-inline">{{ field.help_text }} {% for error in field.errors %}{{ error }} {% endfor %}</span>{% endif %}
           </div>
         </div>
         {% endwith %}
       </div>
     </div>
 
    </div><!-- /.tab-content -->

     <div class="form-group">
      <div class="col-sm-12">
         <button type="submit" class="btn btn-default" name="_addanother" {{ onclick_attrib }}>{% trans 'Save and add another' %}</button>
         <button type="submit" class="btn btn-default" name="_continue" {{ onclick_attrib }}>{% trans 'Save and continue editing' %}</button>
         <button type="submit" class="btn btn-primary">{% trans 'Save' %}</button>
      </div>
     </div>
			
</form>
{% endblock %}